{% extends "base.html" %}

{% block title %}Feedback Form - {{ faculty.name }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-6 sm:px-0">
    <!-- Faculty Info Header -->
    <div class="bg-gradient-to-r from-blue-600 to-blue-800 rounded-lg shadow-xl p-6 mb-8">
        <div class="text-center">
            <h1 class="text-3xl font-bold text-white mb-2">Faculty Feedback Form</h1>
            <div class="bg-white bg-opacity-20 rounded-lg p-4 mt-4">
                <h2 class="text-xl font-semibold text-white mb-2">{{ faculty.name }}</h2>
                <p class="text-blue-100 mb-1">{{ faculty.subject }}</p>
                <p class="text-blue-100">{{ faculty.department }}</p>
            </div>
        </div>
    </div>

    <!-- Feedback Form -->
    <div class="bg-white rounded-lg shadow-md p-8">
        <form method="POST" action="{{ url_for('submit_feedback', faculty_id=faculty.id) }}" id="feedbackForm">

            <!-- 1. Performance -->
            <div class="mb-8">
                <label class="block text-lg font-semibold text-gray-900 mb-4">
                    1. Performance - Overall teaching effectiveness
                </label>
                <div class="flex justify-center space-x-2 mb-4" data-field="performance">
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(1, 'performance')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(2, 'performance')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(3, 'performance')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(4, 'performance')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(5, 'performance')">★</span>
                </div>
                <input type="hidden" name="performance" value="" required>
            </div>

            <!-- 2. Knowledge -->
            <div class="mb-8">
                <label class="block text-lg font-semibold text-gray-900 mb-4">
                    2. Knowledge - Subject matter expertise
                </label>
                <div class="flex justify-center space-x-2 mb-4" data-field="knowledge">
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(1, 'knowledge')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(2, 'knowledge')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(3, 'knowledge')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(4, 'knowledge')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(5, 'knowledge')">★</span>
                </div>
                <input type="hidden" name="knowledge" value="" required>
            </div>

            <!-- 3. Teaching Skills -->
            <div class="mb-8">
                <label class="block text-lg font-semibold text-gray-900 mb-4">
                    3. Teaching Skills - Instructional methods and techniques
                </label>
                <div class="flex justify-center space-x-2 mb-4" data-field="teaching_skills">
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(1, 'teaching_skills')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(2, 'teaching_skills')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(3, 'teaching_skills')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(4, 'teaching_skills')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(5, 'teaching_skills')">★</span>
                </div>
                <input type="hidden" name="teaching_skills" value="" required>
            </div>

            <!-- 4. Communication -->
            <div class="mb-8">
                <label class="block text-lg font-semibold text-gray-900 mb-4">
                    4. Communication - Clarity and explanation of concepts
                </label>
                <div class="flex justify-center space-x-2 mb-4" data-field="communication">
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(1, 'communication')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(2, 'communication')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(3, 'communication')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(4, 'communication')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(5, 'communication')">★</span>
                </div>
                <input type="hidden" name="communication" value="" required>
            </div>

            <!-- 5. Behavior -->
            <div class="mb-8">
                <label class="block text-lg font-semibold text-gray-900 mb-4">
                    5. Behavior - Professional conduct and attitude
                </label>
                <div class="flex justify-center space-x-2 mb-4" data-field="behavior">
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(1, 'behavior')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(2, 'behavior')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(3, 'behavior')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(4, 'behavior')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(5, 'behavior')">★</span>
                </div>
                <input type="hidden" name="behavior" value="" required>
            </div>

            <!-- 6. Class Management -->
            <div class="mb-8">
                <label class="block text-lg font-semibold text-gray-900 mb-4">
                    6. Class Management - Ability to maintain discipline and manage class time effectively
                </label>
                <div class="flex justify-center space-x-2 mb-4" data-field="class_management">
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(1, 'class_management')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(2, 'class_management')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(3, 'class_management')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(4, 'class_management')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(5, 'class_management')">★</span>
                </div>
                <input type="hidden" name="class_management" value="" required>
            </div>

            <!-- 7. Use of Technology -->
            <div class="mb-8">
                <label class="block text-lg font-semibold text-gray-900 mb-4">
                    7. Use of Technology - Effective use of digital tools and teaching aids
                </label>
                <div class="flex justify-center space-x-2 mb-4" data-field="technology_use">
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(1, 'technology_use')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(2, 'technology_use')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(3, 'technology_use')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(4, 'technology_use')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(5, 'technology_use')">★</span>
                </div>
                <input type="hidden" name="technology_use" value="" required>
            </div>

            <!-- 8. Punctuality -->
            <div class="mb-8">
                <label class="block text-lg font-semibold text-gray-900 mb-4">
                    8. Punctuality - Timeliness in class start and completion of syllabus
                </label>
                <div class="flex justify-center space-x-2 mb-4" data-field="punctuality">
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(1, 'punctuality')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(2, 'punctuality')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(3, 'punctuality')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(4, 'punctuality')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(5, 'punctuality')">★</span>
                </div>
                <input type="hidden" name="punctuality" value="" required>
            </div>

            <!-- 9. Student Engagement -->
            <div class="mb-8">
                <label class="block text-lg font-semibold text-gray-900 mb-4">
                    9. Student Engagement - Encourages participation and interaction in class
                </label>
                <div class="flex justify-center space-x-2 mb-4" data-field="student_engagement">
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(1, 'student_engagement')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(2, 'student_engagement')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(3, 'student_engagement')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(4, 'student_engagement')">★</span>
                    <span class="star text-3xl cursor-pointer empty" onclick="setRating(5, 'student_engagement')">★</span>
                </div>
                <input type="hidden" name="student_engagement" value="" required>
            </div>

            <!-- 10. Comments -->
            <div class="mb-8">
                <label for="comments" class="block text-lg font-semibold text-gray-900 mb-4">
                    10. Additional Comments (Optional)
                </label>
                <textarea id="comments" name="comments" rows="6"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                    placeholder="Please provide any additional feedback, suggestions, or comments about the faculty member's teaching..."></textarea>
                <p class="text-sm text-gray-500 mt-2">
                    Your comments will be anonymous and help improve teaching quality.
                </p>
            </div>

            <!-- Submit -->
            <div class="flex justify-center space-x-4">
                <a href="{{ url_for('student_dashboard') }}"
                   class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-md font-medium transition duration-200">
                    Cancel
                </a>
                <button type="submit"
                        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-md font-medium transition duration-200">
                    Submit Feedback
                </button>
            </div>
        </form>
    </div>

    <!-- Privacy Notice -->
    <div class="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6">
        <h3 class="text-lg font-semibold text-blue-800 mb-3">Privacy Notice</h3>
        <div class="text-sm text-blue-700 space-y-2">
            <p>• Your feedback is completely anonymous - your identity will not be revealed to the faculty member.</p>
            <p>• Only administrators can view aggregated feedback reports.</p>
            <p>• Your feedback helps improve the quality of education at our institution.</p>
            <p>• You can only submit one feedback per faculty member.</p>
        </div>
    </div>
</div>

<script>
// Rating stars functionality
function setRating(rating, fieldName) {
    const stars = document.querySelectorAll(`[data-field="${fieldName}"] .star`);
    stars.forEach((star, index) => {
        if (index < rating) {
            star.classList.remove('empty');
            star.classList.add('rating-stars');
        } else {
            star.classList.remove('rating-stars');
            star.classList.add('empty');
        }
    });
    document.querySelector(`input[name="${fieldName}"]`).value = rating;
}

// Form validation
document.getElementById('feedbackForm').addEventListener('submit', function(e) {
    const requiredFields = [
        'performance', 'knowledge', 'teaching_skills', 'communication', 'behavior',
        'class_management', 'technology_use', 'punctuality', 'student_engagement'
    ];
    let isValid = true;

    requiredFields.forEach(field => {
        const value = document.querySelector(`input[name="${field}"]`).value;
        if (!value) {
            isValid = false;
            alert(`Please rate ${field.replace('_', ' ')} before submitting.`);
        }
    });

    if (!isValid) {
        e.preventDefault();
        return false;
    }

    if (!confirm('Are you sure you want to submit this feedback? You cannot modify it after submission.')) {
        e.preventDefault();
        return false;
    }
});
</script>
{% endblock %}
